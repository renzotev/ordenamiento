//Funcion encargada de hacer la validación de números y mostrar mensajes de error
var Validate = (function () {
    //Obtenemos el ID del elemento a validar
    function Validate(id) {
        this.setInput(id);
        Validate.message = "Por favor digite un valor numerico";
    }
    //Iniciamos los eventos
    Validate.prototype.init = function () {
        this.trigger();
    };
    //Creamos al instancia a nuestro elemento a validar
    Validate.prototype.setInput = function (id) {
        this.input = document.getElementById(id);
    };
    //Obtenemos el elemento a validar
    Validate.prototype.getInput = function () {
        return this.input;
    };
    //Validamos que el número sea entero
    Validate.prototype.isInt = function (value) {
        var x;
        if (isNaN(value)) {
            return false;
        }
        x = parseFloat(value);
        return (x | 0) === x;
    };
    //Eventos encargados de valir y mostrar mensajes de error
    Validate.prototype.trigger = function () {
        var _this = this;
        var error = document.querySelector("#" + this.getInput().id + " + .error");
        error.innerHTML = Validate.message;
        this.getInput().parentElement.classList.add("disabled");
        this.getInput().addEventListener('keyup', function (e) {
            var target = e.target;
            var val = target.value;
            target.parentElement.classList.remove("disabled");
            if (_this.isInt(val)) {
                error.classList.remove("error--active");
                target.parentElement.classList.remove("error");
            }
            else if (val.toString() != "") {
                error.classList.add("error--active");
                target.parentElement.classList.add("error");
            }
        }, false);
    };
    return Validate;
}());
/// <reference path="./Sort.ts" />
//Clase con la logica principal de nuestra aplicación
var Form = (function () {
    //Obtenemos los selectores necesarios
    function Form(options) {
        this.setForm(options.inputID);
        this.setInput(options.inputID);
        this.setResult(options.resultID);
        this.setItemClass(options.itemClass);
        this.setSortButton(options.sortID);
    }
    //Iniciar nuestros eventos y crear nuestro objeto a reordenar
    Form.prototype.init = function () {
        this.createSort();
        this.trigger();
    };
    // Setters y Getters encargados de las instacias al DOM
    Form.prototype.setForm = function (id) {
        this.form = document.getElementById(id).parentElement;
    };
    Form.prototype.setInput = function (id) {
        this.input = document.getElementById(id);
    };
    Form.prototype.setResult = function (id) {
        this.result = document.getElementById(id);
    };
    Form.prototype.setItemClass = function (cssClass) {
        this.itemClass = cssClass;
    };
    Form.prototype.setSortButton = function (id) {
        this.sortButton = document.getElementById(id);
    };
    Form.prototype.createSort = function () {
        this.sort = new Sort(this.itemClass);
    };
    Form.prototype.getForm = function () {
        return this.form;
    };
    Form.prototype.getResult = function () {
        return this.result;
    };
    Form.prototype.getInput = function () {
        return this.input;
    };
    Form.prototype.getSortButton = function () {
        return this.sortButton;
    };
    //Eventos principales - Submit del formulario y Clic al botón de reordenar
    Form.prototype.trigger = function () {
        var _this = this;
        this.getForm().addEventListener('submit', function (e) {
            var target = e.target;
            var value = parseInt(_this.getInput().value);
            if (!target.classList.contains('error') && !target.classList.contains('disabled')) {
                var item = document.createElement("div");
                item.classList.add(_this.itemClass);
                item.innerHTML = value.toString();
                var waitTime = 100;
                _this.getInput().value = "";
                if (!_this.sort.isDuplicate(value) && !isNaN(value)) {
                    _this.sort.addItem(value);
                    _this.getResult().appendChild(item);
                    // Esperamos que el elemento sea agregado al dom para poder agregar la animación
                    setTimeout(function () {
                        _this.getResult().lastChild.classList.add("square--added");
                    }, waitTime);
                }
            }
            e.preventDefault();
        }, false);
        this.getSortButton().addEventListener('click', function (e) {
            _this.sort.asc();
            e.preventDefault();
        });
    };
    return Form;
}());
/// <reference path="./Validate.ts" />
/// <reference path="./Form.ts" />
var validate = new Validate("input-num");
validate.init();
var sort = new Form({
    inputID: "input-num",
    resultID: "result",
    itemClass: "square",
    sortID: "sort"
});
sort.init();
// Clase encargada de reordenar nuestro array y el DOM
var Sort = (function () {
    // Obtenemos la clase css de nuestros números
    function Sort(itemSelector) {
        this.items = [];
        this.positions = [];
        this.itemClass = itemSelector;
    }
    //verificamos si existe el elemento que deseamos agregar
    Sort.prototype.isDuplicate = function (n) {
        var result = this.getItems().some(function (item) {
            return item === n;
        });
        return result;
    };
    //Funcion encargada de hacer las llamadas al reordenamiento
    Sort.prototype.asc = function () {
        this.getPositions();
        this._items = this.items.slice();
        this.items = this.mergeSort(this.getItems());
        this.animate();
    };
    //Funcion encargada de animar el reordenamiento
    Sort.prototype.animate = function () {
        var _this = this;
        var elem = document.getElementsByClassName(this.itemClass);
        for (var i = 0; i < elem.length; i++) {
            this.setPosition(i, this.items.indexOf(this._items[i]));
        }
        setTimeout(function () {
            _this.sortDOM();
        }, 700);
    };
    //Callback de la funcion animate() esta funcion se encarga de reordenar el dom despues de la animación
    Sort.prototype.sortDOM = function () {
        var container = document.getElementById("result");
        container.innerHTML = "";
        for (var i = 0; i < this.items.length; i++) {
            var item = document.createElement("div");
            item.classList.add(this.itemClass);
            item.classList.add(this.itemClass + "--added");
            item.innerHTML = this.items[i].toString();
            container.appendChild(item);
        }
    };
    ;
    // Obtenemos los offset de los elementos
    Sort.prototype.getPositions = function () {
        var elem = document.getElementsByClassName(this.itemClass);
        this.positions = [];
        for (var i = 0; i < elem.length; i++) {
            this.positions.push({
                left: elem[i].offsetLeft,
                top: elem[i].offsetTop
            });
        }
    };
    //Se encarga de mover un elemento a una posición especifica
    Sort.prototype.setPosition = function (before, after) {
        var _this = this;
        var elem = document.getElementsByClassName(this.itemClass);
        elem[before].style.position = "absolute";
        elem[before].style.left = this.positions[before].left + "px";
        elem[before].style.top = this.positions[before].top + "px";
        setTimeout(function () {
            elem[before].style.left = _this.positions[after].left + "px";
            elem[before].style.top = _this.positions[after].top + "px";
        }, 100);
    };
    /* Las funciones mergeSort y merge se encargan de reordenar nuestro array
    usando el algoritomo de Ordenamiento por mezcla */
    Sort.prototype.mergeSort = function (arr) {
        var len = arr.length;
        if (len < 2) {
            return arr;
        }
        var mid = Math.floor(len / 2), left = arr.slice(0, mid), right = arr.slice(mid);
        return this.merge(this.mergeSort(left), this.mergeSort(right));
    };
    Sort.prototype.merge = function (left, right) {
        var result = [], lLen = left.length, rLen = right.length, l = 0, r = 0;
        while (l < lLen && r < rLen) {
            if (left[l] < right[r]) {
                result.push(left[l++]);
            }
            else {
                result.push(right[r++]);
            }
        }
        return result.concat(left.slice(l)).concat(right.slice(r));
    };
    //Agregamos un elemento
    Sort.prototype.addItem = function (n) {
        if (!this.isDuplicate(n)) {
            this.items.push(n);
        }
    };
    //Obtenemos el array con todos los elementos
    Sort.prototype.getItems = function () {
        return this.items;
    };
    return Sort;
}());

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC90cy9WYWxpZGF0ZS50cyIsImFwcC90cy9Gb3JtLnRzIiwiYXBwL3RzL2FwcC50cyIsImFwcC90cy9zb3JfdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxpRkFBaUY7QUFFakY7SUFLSSx3Q0FBd0M7SUFDeEMsa0JBQVksRUFBVTtRQUNsQixJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ2xCLFFBQVEsQ0FBQyxPQUFPLEdBQUcsb0NBQW9DLENBQUE7SUFDM0QsQ0FBQztJQUVELHVCQUF1QjtJQUNoQix1QkFBSSxHQUFYO1FBQ0ksSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQ25CLENBQUM7SUFFRCxtREFBbUQ7SUFDM0MsMkJBQVEsR0FBaEIsVUFBaUIsRUFBVTtRQUN2QixJQUFJLENBQUMsS0FBSyxHQUFxQixRQUFRLENBQUMsY0FBYyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQy9ELENBQUM7SUFFRCxpQ0FBaUM7SUFDekIsMkJBQVEsR0FBaEI7UUFDSSxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQztJQUN0QixDQUFDO0lBRUQsb0NBQW9DO0lBQzVCLHdCQUFLLEdBQWIsVUFBYyxLQUFVO1FBQ2xCLElBQUksQ0FBQyxDQUFDO1FBRU4sRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNqQixNQUFNLENBQUMsS0FBSyxDQUFDO1FBQ2YsQ0FBQztRQUVELENBQUMsR0FBRyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUM7UUFFdEIsTUFBTSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUMzQixDQUFDO0lBRUQseURBQXlEO0lBQ2pELDBCQUFPLEdBQWY7UUFBQSxpQkFvQkM7UUFuQkcsSUFBSSxLQUFLLEdBQWdCLFFBQVEsQ0FBQyxhQUFhLENBQUMsR0FBRyxHQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxFQUFFLEdB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TUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUMvRCxDQUFDO0lBRUQsdUJBQXVCO0lBQ2hCLHNCQUFPLEdBQWQsVUFBZSxDQUFTO1FBQ3BCLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDdkIsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDdkIsQ0FBQztJQUNMLENBQUM7SUFFRCw0Q0FBNEM7SUFDckMsdUJBQVEsR0FBZjtRQUNJLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDO0lBQ3RCLENBQUM7SUFDTCxXQUFDO0FBQUQsQ0FySUEsQUFxSUMsSUFBQSIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvL0Z1bmNpb24gZW5jYXJnYWRhIGRlIGhhY2VyIGxhIHZhbGlkYWNpw7NuIGRlIG7Dum1lcm9zIHkgbW9zdHJhciBtZW5zYWplcyBkZSBlcnJvclxyXG5cclxuY2xhc3MgVmFsaWRhdGVcclxue1xyXG4gICAgcHJpdmF0ZSBpbnB1dDogSFRNTElucHV0RWxlbWVudDtcclxuICAgIHB1YmxpYyBzdGF0aWMgbWVzc2FnZTogc3RyaW5nO1xyXG5cclxuICAgIC8vT2J0ZW5lbW9zIGVsIElEIGRlbCBlbGVtZW50byBhIHZhbGlkYXJcclxuICAgIGNvbnN0cnVjdG9yKGlkOiBzdHJpbmcpIHtcclxuICAgICAgICB0aGlzLnNldElucHV0KGlkKTtcclxuICAgICAgICBWYWxpZGF0ZS5tZXNzYWdlID0gXCJQb3IgZmF2b3IgZGlnaXRlIHVuIHZhbG9yIG51bWVyaWNvXCJcclxuICAgIH1cclxuXHJcbiAgICAvL0luaWNpYW1vcyBsb3MgZXZlbnRvc1xyXG4gICAgcHVibGljIGluaXQoKSB7XHJcbiAgICAgICAgdGhpcy50cmlnZ2VyKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy9DcmVhbW9zIGFsIGluc3RhbmNpYSBhIG51ZXN0cm8gZWxlbWVudG8gYSB2YWxpZGFyXHJcbiAgICBwcml2YXRlIHNldElucHV0KGlkOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmlucHV0ID0gPEhUTUxJbnB1dEVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vT2J0ZW5lbW9zIGVsIGVsZW1lbnRvIGEgdmFsaWRhclxyXG4gICAgcHJpdmF0ZSBnZXRJbnB1dCgpOiBIVE1MSW5wdXRFbGVtZW50IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5pbnB1dDtcclxuICAgIH1cclxuXHJcbiAgICAvL1ZhbGlkYW1vcyBxdWUgZWwgbsO6bWVybyBzZWEgZW50ZXJvXHJcbiAgICBwcml2YXRlIGlzSW50KHZhbHVlOiBhbnkpOiBib29sZWFuIHtcclxuICAgICAgICAgIGxldCB4O1xyXG5cclxuICAgICAgICAgIGlmIChpc05hTih2YWx1ZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIHggPSBwYXJzZUZsb2F0KHZhbHVlKTtcclxuXHJcbiAgICAgICAgICByZXR1cm4gKHggfCAwKSA9PT0geDtcclxuICAgIH1cclxuXHJcbiAgICAvL0V2ZW50b3MgZW5jYXJnYWRvcyBkZSB2YWxpciB5IG1vc3RyYXIgbWVuc2FqZXMgZGUgZXJyb3JcclxuICAgIHByaXZhdGUgdHJpZ2dlcigpOiB2b2lkIHtcclxuICAgICAgICBsZXQgZXJyb3IgPSA8SFRNTEVsZW1lbnQ+ZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNcIit0aGlzLmdldElucHV0KCkuaWQgKyBcIiArIC5lcnJvclwiICk7XHJcbiAgICAgICAgZXJyb3IuaW5uZXJIVE1MID0gVmFsaWRhdGUubWVzc2FnZTtcclxuICAgICAgICB0aGlzLmdldElucHV0KCkucGFyZW50RWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiZGlzYWJsZWRcIik7XHJcblxyXG4gICAgICAgIHRoaXMuZ2V0SW5wdXQoKS5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIChlOiBFdmVudCkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgdGFyZ2V0ID0gPEhUTUxJbnB1dEVsZW1lbnQ+ZS50YXJnZXQ7XHJcbiAgICAgICAgICAgIGxldCB2YWwgPSB0YXJnZXQudmFsdWU7XHJcblxyXG4gICAgICAgICAgICB0YXJnZXQucGFyZW50RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwiZGlzYWJsZWRcIik7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5pc0ludCh2YWwpKSB7XHJcbiAgICAgICAgICAgICAgICBlcnJvci5jbGFzc0xpc3QucmVtb3ZlKFwiZXJyb3ItLWFjdGl2ZVwiKTtcclxuICAgICAgICAgICAgICAgIHRhcmdldC5wYXJlbnRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJlcnJvclwiKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICh2YWwudG9TdHJpbmcoKSAhPSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICBlcnJvci5jbGFzc0xpc3QuYWRkKFwiZXJyb3ItLWFjdGl2ZVwiKTtcclxuICAgICAgICAgICAgICAgIHRhcmdldC5wYXJlbnRFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJlcnJvclwiKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9LCBmYWxzZSk7XHJcbiAgICB9XHJcbn1cclxuIiwiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4vU29ydC50c1wiIC8+XHJcblxyXG4vL0ludGVyZmFjZSBlbmNhcmdhZGEgZGUgdmFsaWRhciBsb3MgcGFyYW1ldHJvcyBuZWNlc2FyaW9zIHBhcmEgbnVlc3RyYSBjbGFzZVxyXG5pbnRlcmZhY2UgZm9ybU9wdGlvbnNcclxue1xyXG4gICAgaW5wdXRJRDogc3RyaW5nO1xyXG4gICAgcmVzdWx0SUQ6IHN0cmluZztcclxuICAgIGl0ZW1DbGFzczogc3RyaW5nO1xyXG4gICAgc29ydElEOiBzdHJpbmc7XHJcbn1cclxuXHJcbi8vQ2xhc2UgY29uIGxhIGxvZ2ljYSBwcmluY2lwYWwgZGUgbnVlc3RyYSBhcGxpY2FjacOzblxyXG5jbGFzcyBGb3JtXHJcbntcclxuICAgIHByaXZhdGUgZm9ybTogSFRNTEVsZW1lbnQ7XHJcbiAgICBwcml2YXRlIGlucHV0OiBIVE1MSW5wdXRFbGVtZW50O1xyXG4gICAgcHJpdmF0ZSByZXN1bHQ6IEhUTUxFbGVtZW50O1xyXG4gICAgcHJpdmF0ZSBzb3J0OiBTb3J0O1xyXG4gICAgcHJpdmF0ZSBpdGVtQ2xhc3M6IHN0cmluZztcclxuICAgIHByaXZhdGUgc29ydEJ1dHRvbjogSFRNTEVsZW1lbnQ7XHJcblxyXG4gICAgLy9PYnRlbmVtb3MgbG9zIHNlbGVjdG9yZXMgbmVjZXNhcmlvc1xyXG4gICAgY29uc3RydWN0b3Iob3B0aW9uczogZm9ybU9wdGlvbnMpIHtcclxuICAgICAgICB0aGlzLnNldEZvcm0ob3B0aW9ucy5pbnB1dElEKTtcclxuICAgICAgICB0aGlzLnNldElucHV0KG9wdGlvbnMuaW5wdXRJRCk7XHJcbiAgICAgICAgdGhpcy5zZXRSZXN1bHQob3B0aW9ucy5yZXN1bHRJRCk7XHJcbiAgICAgICAgdGhpcy5zZXRJdGVtQ2xhc3Mob3B0aW9ucy5pdGVtQ2xhc3MpO1xyXG4gICAgICAgIHRoaXMuc2V0U29ydEJ1dHRvbihvcHRpb25zLnNvcnRJRCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy9JbmljaWFyIG51ZXN0cm9zIGV2ZW50b3MgeSBjcmVhciBudWVzdHJvIG9iamV0byBhIHJlb3JkZW5hclxyXG4gICAgcHVibGljIGluaXQoKSB7XHJcbiAgICAgICAgdGhpcy5jcmVhdGVTb3J0KCk7XHJcbiAgICAgICAgdGhpcy50cmlnZ2VyKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gU2V0dGVycyB5IEdldHRlcnMgZW5jYXJnYWRvcyBkZSBsYXMgaW5zdGFjaWFzIGFsIERPTVxyXG4gICAgcHJpdmF0ZSBzZXRGb3JtKGlkOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmZvcm0gPSA8SFRNTEVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpLnBhcmVudEVsZW1lbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZXRJbnB1dChpZDogc3RyaW5nKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5pbnB1dCA9IDxIVE1MSW5wdXRFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNldFJlc3VsdChpZDogc3RyaW5nKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5yZXN1bHQgPSA8SFRNTEVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2V0SXRlbUNsYXNzKGNzc0NsYXNzOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLml0ZW1DbGFzcyA9IGNzc0NsYXNzO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2V0U29ydEJ1dHRvbihpZDogc3RyaW5nKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5zb3J0QnV0dG9uID0gPEhUTUxFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNyZWF0ZVNvcnQoKSB7XHJcbiAgICAgICAgdGhpcy5zb3J0ID0gbmV3IFNvcnQodGhpcy5pdGVtQ2xhc3MpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0Rm9ybSgpOiBIVE1MRWxlbWVudCB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZm9ybTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldFJlc3VsdCgpOiBIVE1MRWxlbWVudCB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucmVzdWx0O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0SW5wdXQoKTogSFRNTElucHV0RWxlbWVudCB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5wdXQ7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRTb3J0QnV0dG9uKCk6IEhUTUxFbGVtZW50IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5zb3J0QnV0dG9uO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvL0V2ZW50b3MgcHJpbmNpcGFsZXMgLSBTdWJtaXQgZGVsIGZvcm11bGFyaW8geSBDbGljIGFsIGJvdMOzbiBkZSByZW9yZGVuYXJcclxuICAgIHByaXZhdGUgdHJpZ2dlcigpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmdldEZvcm0oKS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCAoZTogRXZlbnQpID0+IHtcclxuICAgICAgICAgICAgbGV0IHRhcmdldCA9IDxIVE1MRWxlbWVudD5lLnRhcmdldDtcclxuICAgICAgICAgICAgbGV0IHZhbHVlOm51bWJlciA9IHBhcnNlSW50KHRoaXMuZ2V0SW5wdXQoKS52YWx1ZSk7XHJcblxyXG4gICAgICAgICAgICBpZiAoIXRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2Vycm9yJykgJiYgIXRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2Rpc2FibGVkJykpIHtcclxuICAgICAgICAgICAgICAgIGxldCBpdGVtID0gPEhUTUxFbGVtZW50PmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5jbGFzc0xpc3QuYWRkKHRoaXMuaXRlbUNsYXNzKTtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtLmlubmVySFRNTCA9IHZhbHVlLnRvU3RyaW5nKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IHdhaXRUaW1lID0gMTAwO1xyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMuZ2V0SW5wdXQoKS52YWx1ZSA9IFwiXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLnNvcnQuaXNEdXBsaWNhdGUodmFsdWUpICYmICFpc05hTih2YWx1ZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNvcnQuYWRkSXRlbSh2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRSZXN1bHQoKS5hcHBlbmRDaGlsZChpdGVtKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gRXNwZXJhbW9zIHF1ZSBlbCBlbGVtZW50byBzZWEgYWdyZWdhZG8gYWwgZG9tIHBhcmEgcG9kZXIgYWdyZWdhciBsYSBhbmltYWNpw7NuXHJcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCggKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAoPEhUTUxFbGVtZW50PnRoaXMuZ2V0UmVzdWx0KCkubGFzdENoaWxkKS5jbGFzc0xpc3QuYWRkKFwic3F1YXJlLS1hZGRlZFwiKTtcclxuICAgICAgICAgICAgICAgICAgICB9LCB3YWl0VGltZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICB9LCBmYWxzZSk7XHJcblxyXG4gICAgICAgIHRoaXMuZ2V0U29ydEJ1dHRvbigpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGU6IEV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuc29ydC5hc2MoKTtcclxuXHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufVxyXG4iLCIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi9WYWxpZGF0ZS50c1wiIC8+XHJcbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuL0Zvcm0udHNcIiAvPlxyXG5cclxudmFyIHZhbGlkYXRlID0gbmV3IFZhbGlkYXRlKFwiaW5wdXQtbnVtXCIpO1xyXG4gICAgdmFsaWRhdGUuaW5pdCgpO1xyXG5cclxudmFyIHNvcnQgPSBuZXcgRm9ybSh7XHJcbiAgICBpbnB1dElEOiAgXCJpbnB1dC1udW1cIixcclxuICAgIHJlc3VsdElEOiBcInJlc3VsdFwiLFxyXG4gICAgaXRlbUNsYXNzOiBcInNxdWFyZVwiLFxyXG4gICAgc29ydElEOiBcInNvcnRcIlxyXG59KTtcclxuICAgIHNvcnQuaW5pdCgpO1xyXG4iLCIvLyBDbGFzZSBlbmNhcmdhZGEgZGUgcmVvcmRlbmFyIG51ZXN0cm8gYXJyYXkgeSBlbCBET01cclxuXHJcbmNsYXNzIFNvcnRcclxue1xyXG4gICAgcHJpdmF0ZSBpdGVtczogbnVtYmVyW107XHJcbiAgICBwcml2YXRlIF9pdGVtczogbnVtYmVyW107XHJcbiAgICBwcml2YXRlIGl0ZW1DbGFzczogc3RyaW5nO1xyXG4gICAgcHJpdmF0ZSBwb3NpdGlvbnM6IGFueVtdO1xyXG5cclxuICAgIC8vIE9idGVuZW1vcyBsYSBjbGFzZSBjc3MgZGUgbnVlc3Ryb3MgbsO6bWVyb3NcclxuICAgIGNvbnN0cnVjdG9yKGl0ZW1TZWxlY3Rvcjogc3RyaW5nKSB7XHJcbiAgICAgICAgdGhpcy5pdGVtcyA9IFtdO1xyXG4gICAgICAgIHRoaXMucG9zaXRpb25zID0gW107XHJcbiAgICAgICAgdGhpcy5pdGVtQ2xhc3MgPSBpdGVtU2VsZWN0b3I7XHJcbiAgICB9XHJcblxyXG4gICAgLy92ZXJpZmljYW1vcyBzaSBleGlzdGUgZWwgZWxlbWVudG8gcXVlIGRlc2VhbW9zIGFncmVnYXJcclxuICAgIHB1YmxpYyBpc0R1cGxpY2F0ZShuOiBudW1iZXIpOiBib29sZWFuIHtcclxuICAgICAgICBsZXQgcmVzdWx0OiBib29sZWFuID0gdGhpcy5nZXRJdGVtcygpLnNvbWUoIChpdGVtKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBpdGVtID09PSBuO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfVxyXG5cclxuICAgIC8vRnVuY2lvbiBlbmNhcmdhZGEgZGUgaGFjZXIgbGFzIGxsYW1hZGFzIGFsIHJlb3JkZW5hbWllbnRvXHJcbiAgICBwdWJsaWMgYXNjKCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuZ2V0UG9zaXRpb25zKCk7XHJcbiAgICAgICAgdGhpcy5faXRlbXMgPSB0aGlzLml0ZW1zLnNsaWNlKCk7XHJcbiAgICAgICAgdGhpcy5pdGVtcyA9IHRoaXMubWVyZ2VTb3J0KHRoaXMuZ2V0SXRlbXMoKSk7XHJcbiAgICAgICAgdGhpcy5hbmltYXRlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy9GdW5jaW9uIGVuY2FyZ2FkYSBkZSBhbmltYXIgZWwgcmVvcmRlbmFtaWVudG9cclxuICAgIHB1YmxpYyBhbmltYXRlKCk6IHZvaWQge1xyXG4gICAgICAgIGxldCBlbGVtOiBhbnkgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKHRoaXMuaXRlbUNsYXNzKTtcclxuXHJcbiAgICAgICAgZm9yKGxldCBpOiBudW1iZXIgPSAwOyBpIDwgZWxlbS5sZW5ndGg7IGkrKyl7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0UG9zaXRpb24oaSwgdGhpcy5pdGVtcy5pbmRleE9mKHRoaXMuX2l0ZW1zW2ldKSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzZXRUaW1lb3V0KCAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuc29ydERPTSgpO1xyXG4gICAgICAgIH0sIDcwMCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy9DYWxsYmFjayBkZSBsYSBmdW5jaW9uIGFuaW1hdGUoKSBlc3RhIGZ1bmNpb24gc2UgZW5jYXJnYSBkZSByZW9yZGVuYXIgZWwgZG9tIGRlc3B1ZXMgZGUgbGEgYW5pbWFjacOzblxyXG4gICAgcHJpdmF0ZSBzb3J0RE9NKCk6dm9pZCB7XHJcbiAgICAgICAgbGV0IGNvbnRhaW5lciA9IDxIVE1MRWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJlc3VsdFwiKTtcclxuXHJcbiAgICAgICAgY29udGFpbmVyLmlubmVySFRNTCA9IFwiXCI7XHJcblxyXG4gICAgICAgIGZvcihsZXQgaTogbnVtYmVyID0gMDsgaSA8IHRoaXMuaXRlbXMubGVuZ3RoOyBpKyspe1xyXG4gICAgICAgICAgICBsZXQgaXRlbSA9IDxIVE1MRWxlbWVudD5kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgICAgICAgaXRlbS5jbGFzc0xpc3QuYWRkKHRoaXMuaXRlbUNsYXNzKTtcclxuICAgICAgICAgICAgICAgIGl0ZW0uY2xhc3NMaXN0LmFkZCh0aGlzLml0ZW1DbGFzcytcIi0tYWRkZWRcIik7XHJcbiAgICAgICAgICAgICAgICBpdGVtLmlubmVySFRNTCA9IHRoaXMuaXRlbXNbaV0udG9TdHJpbmcoKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChpdGVtKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIE9idGVuZW1vcyBsb3Mgb2Zmc2V0IGRlIGxvcyBlbGVtZW50b3NcclxuICAgIHByaXZhdGUgZ2V0UG9zaXRpb25zKCk6IHZvaWQge1xyXG4gICAgICAgIGxldCBlbGVtOiBhbnkgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKHRoaXMuaXRlbUNsYXNzKTtcclxuICAgICAgICB0aGlzLnBvc2l0aW9ucyA9IFtdXHJcblxyXG4gICAgICAgIGZvcihsZXQgaTogbnVtYmVyID0gMDsgaSA8IGVsZW0ubGVuZ3RoOyBpKyspe1xyXG5cclxuICAgICAgICAgICB0aGlzLnBvc2l0aW9ucy5wdXNoKHtcclxuICAgICAgICAgICAgICAgbGVmdDogZWxlbVtpXS5vZmZzZXRMZWZ0LFxyXG4gICAgICAgICAgICAgICB0b3A6IGVsZW1baV0ub2Zmc2V0VG9wXHJcbiAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vU2UgZW5jYXJnYSBkZSBtb3ZlciB1biBlbGVtZW50byBhIHVuYSBwb3NpY2nDs24gZXNwZWNpZmljYVxyXG4gICAgcHJpdmF0ZSBzZXRQb3NpdGlvbihiZWZvcmU6IG51bWJlciwgYWZ0ZXI6IG51bWJlcik6IHZvaWQge1xyXG4gICAgICAgIGxldCBlbGVtOiBhbnkgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKHRoaXMuaXRlbUNsYXNzKTtcclxuXHJcbiAgICAgICAgZWxlbVtiZWZvcmVdLnN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiO1xyXG4gICAgICAgIGVsZW1bYmVmb3JlXS5zdHlsZS5sZWZ0ID0gdGhpcy5wb3NpdGlvbnNbYmVmb3JlXS5sZWZ0K1wicHhcIjtcclxuICAgICAgICBlbGVtW2JlZm9yZV0uc3R5bGUudG9wID0gdGhpcy5wb3NpdGlvbnNbYmVmb3JlXS50b3ArXCJweFwiO1xyXG5cclxuICAgICAgICBzZXRUaW1lb3V0KCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGVsZW1bYmVmb3JlXS5zdHlsZS5sZWZ0ID0gdGhpcy5wb3NpdGlvbnNbYWZ0ZXJdLmxlZnQrXCJweFwiO1xyXG4gICAgICAgICAgICBlbGVtW2JlZm9yZV0uc3R5bGUudG9wID0gdGhpcy5wb3NpdGlvbnNbYWZ0ZXJdLnRvcCtcInB4XCI7XHJcbiAgICAgICAgfSwgMTAwKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgLyogTGFzIGZ1bmNpb25lcyBtZXJnZVNvcnQgeSBtZXJnZSBzZSBlbmNhcmdhbiBkZSByZW9yZGVuYXIgbnVlc3RybyBhcnJheVxyXG4gICAgdXNhbmRvIGVsIGFsZ29yaXRvbW8gZGUgT3JkZW5hbWllbnRvIHBvciBtZXpjbGEgKi9cclxuICAgIHByaXZhdGUgbWVyZ2VTb3J0KGFycjogbnVtYmVyW10pOiBudW1iZXJbXSB7XHJcbiAgICAgICAgdmFyIGxlbiA9IGFyci5sZW5ndGg7XHJcblxyXG4gICAgICAgIGlmIChsZW4gPDIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGFycjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBtaWQgPSBNYXRoLmZsb29yKGxlbi8yKSxcclxuICAgICAgICAgICAgbGVmdCA9IGFyci5zbGljZSgwLG1pZCksXHJcbiAgICAgICAgICAgIHJpZ2h0ID1hcnIuc2xpY2UobWlkKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMubWVyZ2UodGhpcy5tZXJnZVNvcnQobGVmdCksIHRoaXMubWVyZ2VTb3J0KHJpZ2h0KSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBtZXJnZShsZWZ0OiBudW1iZXJbXSwgcmlnaHQ6IG51bWJlcltdKTogbnVtYmVyW10ge1xyXG4gICAgICAgIHZhciByZXN1bHQgPSBbXSxcclxuICAgICAgICAgICAgbExlbiA9IGxlZnQubGVuZ3RoLFxyXG4gICAgICAgICAgICByTGVuID0gcmlnaHQubGVuZ3RoLFxyXG4gICAgICAgICAgICBsID0gMCxcclxuICAgICAgICAgICAgciA9IDA7XHJcbiAgICAgICAgICAgIHdoaWxlKGwgPCBsTGVuICYmIHIgPCByTGVuKXtcclxuICAgICAgICAgICAgICAgIGlmKGxlZnRbbF0gPCByaWdodFtyXSl7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaChsZWZ0W2wrK10pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gocmlnaHRbcisrXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiByZXN1bHQuY29uY2F0KGxlZnQuc2xpY2UobCkpLmNvbmNhdChyaWdodC5zbGljZShyKSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy9BZ3JlZ2Ftb3MgdW4gZWxlbWVudG9cclxuICAgIHB1YmxpYyBhZGRJdGVtKG46IG51bWJlcik6IHZvaWQge1xyXG4gICAgICAgIGlmICghdGhpcy5pc0R1cGxpY2F0ZShuKSkge1xyXG4gICAgICAgICAgICB0aGlzLml0ZW1zLnB1c2gobik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vT2J0ZW5lbW9zIGVsIGFycmF5IGNvbiB0b2RvcyBsb3MgZWxlbWVudG9zXHJcbiAgICBwdWJsaWMgZ2V0SXRlbXMoKTogbnVtYmVyW10ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLml0ZW1zO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==
